# Ambiente de Desarrollo - Venered

## Variables de Entorno

Copiar este archivo a `.env` y llenar con tus valores:

```bash
# Supabase Configuration
SUPABASE_URL=https://tu-proyecto.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# API Configuration
API_TIMEOUT=30000
API_RETRY_ATTEMPTS=3

# Media Configuration
MAX_IMAGE_SIZE=10485760          # 10MB en bytes
MAX_VIDEO_SIZE=104857600         # 100MB en bytes
DEFAULT_IMAGE_QUALITY=0.8
DEFAULT_IMAGE_COMPRESSION=80

# Feature Flags
ENABLE_NOTIFICATIONS=true
ENABLE_PUSH_NOTIFICATIONS=false
ENABLE_ANALYTICS=false

# Build Configuration
APP_VERSION=0.0.1
BUILD_NUMBER=1

# Debug
__DEV__=true
VERBOSE_LOGGING=false
```

## Instalación de Dependencias

### Node + npm

```bash
# Usando nvm (recomendado)
curl https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# Verificar
node --version  # v20.x.x
npm --version   # v10.x.x
```

### Java JDK 17

```bash
sudo apt update
sudo apt install -y openjdk-17-jdk
java -version

# Configurar JAVA_HOME
echo 'export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64' >> ~/.bashrc
source ~/.bashrc
```

### Android SDK

```bash
# Crear directorio
mkdir -p ~/Android/Sdk
cd ~/Android/Sdk

# Descargar Command Line Tools
wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
unzip commandlinetools-linux-*_latest.zip
rm *.zip

# Estructura correcta
mkdir -p cmdline-tools/latest
mv cmdline-tools/* cmdline-tools/latest/ || true

# Variables de entorno
echo 'export ANDROID_HOME=$HOME/Android/Sdk' >> ~/.bashrc
echo 'export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$PATH' >> ~/.bashrc
echo 'export PATH=$ANDROID_HOME/platform-tools:$PATH' >> ~/.bashrc
source ~/.bashrc
```

### Paquetes del SDK

```bash
# Aceptar licencias
yes | sdkmanager --licenses

# Instalar
sdkmanager "platform-tools"
sdkmanager "platforms;android-34"
sdkmanager "build-tools;34.0.0"
sdkmanager "ndk;25.1.8937393"
sdkmanager "cmake;3.22.1"
```

## Configuración del Proyecto

```bash
# 1. Navegar a la carpeta
cd Venered

# 2. Instalar dependencias npm
npm install

# 3. Copiar variables de entorno
cp .env.example .env
# Editar .env con credenciales reales

# 4. Setup de Android
cd android
./gradlew build
cd ..

# 5. Verificar setup
npm run type-check
npm run lint
```

## Estructura de Carpetas (A Crear)

Después de instalar el proyecto inicial:

```bash
# Crear carpetas principales
mkdir -p src/{assets,components,screens,services,context,types,hooks,theme,utils,supabase}

# Crear subcarpetas de componentes
mkdir -p src/components/{ui,feed,profile,modals,navigation}

# Crear subcarpetas de screens
mkdir -p src/screens/{auth,home,social,create,notifications,explore,messages,admin}

# Crear subcarpetas de services
mkdir -p src/services/{auth,social,posts,media,notifications,federation}

# Crear carpeta de documentación
mkdir -p docs
```

## Primeros Pasos

### 1. Crear Proyecto Supabase

Ir a https://supabase.com y:
- Crear nuevo proyecto
- Ir a Settings > API
- Copiar URL y anon key
- Actualizar `.env`

### 2. Ejecutar SQL de Base de Datos

En Supabase SQL Editor, copiar y ejecutar el contenido de `docs/DATABASE.md`:
- Crear tablas
- Crear índices
- Crear RLS policies
- Crear triggers
- Crear functions

### 3. Iniciar Desarrollo

```bash
# Terminal 1: Metro Bundler
npm start

# Terminal 2: Android Build
npm run android

# Ver logs
adb logcat | grep React
```

### 4. Estructura de Tipo TypeScript

Crear `src/types/index.ts`:

```typescript
// User types
export interface User {
  id: string;
  email: string;
  username: string;
  displayName: string;
  avatarUrl?: string;
  bio?: string;
  isPrivate: boolean;
  isVerified: boolean;
  createdAt: string;
}

// Post types
export interface Post {
  id: string;
  userId: string;
  caption: string;
  visibility: 'public' | 'private' | 'unlisted';
  hasMedia: boolean;
  mediaCount: number;
  likesCount: number;
  commentsCount: number;
  createdAt: string;
  updatedAt: string;
}

// Media types
export interface Media {
  id: string;
  postId: string;
  mediaType: 'photo' | 'video';
  url: string;
  thumbnailUrl?: string;
  width?: number;
  height?: number;
  duration?: number;
  sortOrder: number;
}

// Notification types
export interface Notification {
  id: string;
  recipientId: string;
  senderId?: string;
  type: 'like' | 'comment' | 'follow' | 'mention' | 'reply';
  postId?: string;
  commentId?: string;
  isRead: boolean;
  createdAt: string;
}
```

## Configuración de IDE

### VS Code

Instalar extensiones recomendadas:
- ES7+ React/Redux/React-Native snippets
- Prettier
- ESLint
- TypeScript Vue Plugin
- Android Tools

Archivo `.vscode/settings.json`:

```json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "typescript.enablePromptUseWorkspaceTsdk": true
}
```

### GIT Hooks (Opcional)

Configurar Husky para validar antes de commit:

```bash
npm install husky lint-staged --save-dev
npx husky install

# Crear hooks
cat > .husky/pre-commit << 'EOF'
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
EOF

chmod +x .husky/pre-commit
```

Configurar `package.json`:

```json
{
  "lint-staged": {
    "*.{ts,tsx}": ["eslint --fix", "prettier --write"],
    "*.md": ["prettier --write"]
  }
}
```

## Troubleshooting

### Error: "Cannot find symbol: class R" (Android)

```bash
# Opción 1: Clean build
npm run clean:android
npm run android

# Opción 2: Invalidate cache
rm -rf android/.gradle
npm run android
```

### Error: "SDK location not found"

```bash
echo "sdk.dir=$ANDROID_HOME" > android/local.properties
```

### Node modules corrupted

```bash
rm -rf node_modules package-lock.json
npm install
```

### Metro bundler stuck

```bash
# Kill proceso
npm start -- --reset-cache

# O en otra terminal
pkill -f "metro|react-native"
```

### ADB device not found

```bash
adb kill-server
adb start-server
adb devices

# Si sigue sin aparecer
# 1. Habilitar USB debugging en dispositivo
# 2. Aceptar permitir acceso USB en teléfono
# 3. Probar: adb reverse tcp:8081 tcp:8081
```

## Performance Tips

### Mejorar velocidad de build

```bash
# Habilitar gradle daemon
echo "org.gradle.daemon=true" >> android/gradle.properties

# Parallel builds
echo "org.gradle.parallel=true" >> android/gradle.properties

# Increase memory
echo "org.gradle.jvmargs=-Xmx4096m -XX:MaxMetaspaceSize=1024m" >> android/gradle.properties
```

### Mejorar Metro bundler

```bash
# Usar watchman (file watcher nativo)
sudo apt install watchman

# Metro debería detectarlo automáticamente
```

### Reducir tamaño de node_modules

```bash
# Usar npm ci en lugar de npm install en CI
npm ci

# Usar npm prune en producción
npm prune --production
```

## Checklists

### Antes de empezar a programar

- [ ] Node.js 20+ instalado
- [ ] Java JDK 17 instalado
- [ ] Android SDK configurado
- [ ] Proyecto Supabase creado
- [ ] Variables de entorno configuradas
- [ ] npm install completado sin errores
- [ ] Gradle build completado (`./gradlew build`)
- [ ] Metro bundler inicia sin errores (`npm start`)
- [ ] APK se construye sin errores (`npm run android`)

### Antes de hacer commit

- [ ] `npm run lint` sin errores
- [ ] `npm run type-check` sin errores
- [ ] App no tiene crashes
- [ ] Nuevo código tiene comentarios si es complejo
- [ ] Commit message sigue conventional commits

### Antes de release

- [ ] Todas las features de la fase testeadas
- [ ] Documentación actualizada
- [ ] VERSION actualizada en package.json
- [ ] Release notes creadas
- [ ] Performance checklist completado

## Recursos

- [React Native Docs](https://reactnative.dev/)
- [Supabase Docs](https://supabase.com/docs)
- [Android Developer Docs](https://developer.android.com/docs)
- [React Navigation](https://reactnavigation.org/docs/getting-started)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
